# CVE-2021-40444

<br>

> Fail zero day - Exécution de code à distance lors de l'ouverture d'un document malveillant Microsoft Office

<br>

## Aspect technique

<br>

### Késako ?

<br>

Il s'agit d'une vulnérabilité critique dans le moteur de rendu MSHTML. Les applications Microsoft Office utilisent le moteur MSHTML pour traiter et afficher le contenu Web. Un attaquant qui exploite avec succès cette faille zéro day CVE-2021-40444 pourrait obtenir un contrôle total sur un système cible en utilisant des contrôles ActiveX malveillants pour exécuter du code arbitraire.

<br>

Des acteurs malveillants exploitent cette vulnérabilité en utilisant des documents Microsoft Office spécialement conçus. Celui-ci utilise le moteur MSHTML pour ouvrir un site Web malveillant hébergé sur un point de terminaison contrôlé par un attaquant. Ce site Web existe en tant qu'objet MIME HTML (MHTML) Object Linking and Embedding (OLE) dans le contexte du document. Le site Web exécute du code JavaScript et des contrôles ActiveX qui exécutent ensuite un code malveillant sur le système où le document Office malveillant a été ouvert. Ce code est hébergé sur le point de terminaison contrôlé par l'attaquant sous la forme d'une bibliothèque de liens dynamiques (DLL).

<br>

### Résumé 

<br>

Pour exploiter la vulnérabilité CVE-2021-40444, l'attaquant incite un utilisateur à ouvrir un document Office spécialement conçu et à cliquer sur Activer le contenu pour désactiver la fonction Microsoft Office Protected View. La fonctionnalité Vue protégée est activée par défaut et bloque l'exécution de code potentiellement malveillant dans le contexte des documents Office.

<br>

### Solutions de contournement ?

<br>

> Solution 1 :

<br>

Désactiver les contrôles ActiveX sur un système par l’intermédiaire d’une clé de Registre

<br>

**Avertissement Toute utilisation incorrecte de l’Éditeur du Registre peut générer des problèmes graves, pouvant vous obliger à réinstaller votre système d’exploitation. Microsoft ne peut garantir que les problèmes résultant d’une mauvaise utilisation de l’Éditeur du Registre puissent être résolus. Vous assumez l’ensemble des risques liés à l’utilisation de cet outil.**

<br>

1- Pour désactiver l’installation des contrôles ActiveX dans Internet Explorer dans toutes les zones, collez le texte suivant dans un fichier texte et enregistrez-le avec l’extension de fichier .reg :

<br>

```
Windows Registry Editor Version 5.00

[HKEY_LOCAL_MACHINE\SOFTWARE\Policies\Microsoft\Windows\CurrentVersion\Internet Settings\Zones\0]
"1001"=dword:00000003
"1004"=dword:00000003

[HKEY_LOCAL_MACHINE\SOFTWARE\Policies\Microsoft\Windows\CurrentVersion\Internet Settings\Zones\1]
"1001"=dword:00000003
"1004"=dword:00000003

[HKEY_LOCAL_MACHINE\SOFTWARE\Policies\Microsoft\Windows\CurrentVersion\Internet Settings\Zones\2]
"1001"=dword:00000003
"1004"=dword:00000003

[HKEY_LOCAL_MACHINE\SOFTWARE\Policies\Microsoft\Windows\CurrentVersion\Internet Settings\Zones\3]
"1001"=dword:00000003
"1004"=dword:00000003
```

<br>

2- Double-cliquez sur le fichier .reg pour l’appliquer à votre ruche de stratégies.

<br>

3- Redémarrez le système pour vous assurer que la nouvelle configuration a bien été appliquée.

<br>

> Solution 2 :

<br>

Pour désactiver la visualisation dans l’Explorateur Windows

<br>

La désactivation de la visualisation Shell empêche un utilisateur de visualiser les documents dans l’Explorateur Windows. Procédez comme suit pour chaque type de document dont vous souhaitez désactiver la visualisation :

<br>

Dans l’Éditeur du Registre, accédez à la clé de Registre appropriée :

<br>

```
Pour les documents Word :

    HKEY_CLASSES_ROOT.docx\ShellEx{8895b1c6-b41f-4c1c-a562-0d564250836f}
    HKEY_CLASSES_ROOT.doc\ShellEx{8895b1c6-b41f-4c1c-a562-0d564250836f}
    HKEY_CLASSES_ROOT.docm\ShellEx{8895b1c6-b41f-4c1c-a562-0d564250836f}
```

<br>

```
Pour les fichiers RTF :

    HKEY_CLASSES_ROOT.rtf\ShellEx{8895b1c6-b41f-4c1c-a562-0d564250836f}

    Exportez une copie de la clé de Registre à des fins de sauvegarde.
    Double-cliquez sur le nom puis, dans la boîte de dialogue Modification de la chaîne, supprimez les données de la valeur.
    Cliquez sur OK.
```

<br>

## Vulgarisation

<br>

Il s'agit d'une vulnérabilité qui permet à un attaquant d'exécuter du code à distance lors de l'ouverture d'un document malveillant Microsoft office.     

<br>

## Sources 

<br>

- <a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-40444"> Mitre - CVE-2021-40444 </a>
- <a href="https://www.zdnet.com/article/microsoft-cisa-urge-use-of-mitigations-and-workarounds-for-office-document-vulnerability/"> zdnet.com - microsoft office document vulnerability </a>
- <a href="https://msrc.microsoft.com/update-guide/vulnerability/CVE-2021-40444"> Microsoft update guide - CVE-2021-40444 </a>
- <a href="https://www.cybereason.com/blog/threat-alert-microsoft-mshtml-remote-code-execution-vulnerability"> cybereason </a>
# CVE-2021-22908

## Définition

Une vulnérabilité de dépassement de mémoire tampon existe dans les profils de ressources de fichiers Windows dans 9.X. Il permet à un utilisateur distant authentifié avec des privilèges de parcourir les partages SMB pour exécuter du code arbitraire en tant qu'utilisateur root. Depuis la version 9.1R3, cette autorisation n'est pas activée par défaut.

## Aspect technique

Les tampons sont des régions de stockage de mémoire qui contiennent temporairement des données pendant leur transfert d'un emplacement à un autre. Un buffer overflow (ou buffer overrun) se produit lorsque le volume de données dépasse la capacité de stockage de la mémoire tampon. En conséquence, le programme tentant d'écrire les données dans la mémoire tampon écrase les emplacements de mémoire adjacents.

Par exemple, un tampon pour les identifiants de connexion peut être conçu pour s'attendre à des entrées de nom d'utilisateur et de mot de passe de 8 octets, donc si une transaction implique une entrée de 10 octets (c'est-à-dire 2 octets de plus que prévu), le programme peut écrire l'excédent données au-delà de la limite du tampon.

Les débordements de buffer peuvent affecter tous les types de logiciels. Ils résultent généralement d'entrées mal formées ou de l'incapacité à allouer suffisamment d'espace pour le tampon. Si la transaction écrase le code exécutable, le programme peut se comporter de manière imprévisible et générer des résultats incorrects, des erreurs d'accès à la mémoire ou des plantages.

<img src="https://www.imperva.com/learn/wp-content/uploads/sites/13/2018/01/buffer-overflow.png">

## Vulgarisation

Les attaquants exploitent les problèmes de dépassement de mémoire tampon en écrasant la mémoire d'une application. Cela modifie le chemin d'exécution du programme, déclenchant une réponse qui endommage les fichiers ou expose des informations privées. Par exemple, un attaquant peut introduire du code supplémentaire, envoyant de nouvelles instructions à l'application pour accéder aux systèmes informatiques.

Si les attaquants connaissent la disposition de la mémoire d'un programme, ils peuvent intentionnellement alimenter une entrée que le tampon ne peut pas stocker et écraser les zones qui contiennent du code exécutable, en le remplaçant par leur propre code. Par exemple, un attaquant peut écraser un pointeur (un objet qui pointe vers une autre zone en mémoire) et le pointer vers une charge utile d'exploit, pour prendre le contrôle du programme.

## Récapitulatif

Imaginons que nous avons un emplacement mémoire pour une variable. Lorsque l'attaquant arrive à envoyer plus de données que supporte la mémoire tampon pour cette emplacement, il y a dépassement qui va prendre l'allocation des cases qui sont a côté pour compléter. Sauf que cela crée un dysfonctionnement car chaque emplacement mémoire est alloué suivant son type etc.

Il faut que l'attaquant aie une bonne connaissance au niveau des architectures logiciels et de l'utilisation des pointeurs pour pouvoir exploiter cette faille.

## Sources 

- <a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-22908"> Source : MITRE </a>

- <a href="https://www.cert.ssi.gouv.fr/actualite/CERTFR-2021-ACT-021/"> Source : CERT SSI GOUV </a>

- <a href="https://www.cyberveille-sante.gouv.fr/cyberveille/2548-vulnerabilite-dans-pulse-connect-secure-2021-05-18"> Source : Cyberveille </a>

- <a href="https://github.com/CERTCC/PoC-Exploits/blob/master/cve-2021-22908/cve-2021-22908.py"> Exploit </a>


- <a href="https://kb.pulsesecure.net/articles/Pulse_Security_Advisories/SA44800/"> Pulse secure </a>

- <a href="https://www.imperva.com/learn/application-security/buffer-overflow/"> Qu'est-ce qu'une attaque "buffer overflow" ? </a>